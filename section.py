import numpy as np
import os
import json
import pickle
from collections import defaultdict
from importance import permutation_importance

files = ['ffridataset2020_malware.jsonl', 'ffridataset2020_cleanware.jsonl']
if os.path.isfile('./section.txt'):
    with open('section.txt', 'rb') as fp:
        cnt_sec = pickle.load(fp)
else:
    section = defaultdict(int)
    for fname in files:
        with open(fname) as fp:
            for line in fp:
                data = json.loads(line)
                lief = data['lief']
                sec = lief.get('sections')
                for s in sec:
                    section[s['name']] += 1

    section = dict(section)
    cnt_sec = sorted(section.items(), key=lambda x:x[1], reverse=True)
    with open('section.txt', 'wb') as fp:
        pickle.dump(cnt_sec, fp)

print(cnt_sec)
sec_list = []
idx = 0
for s, c in cnt_sec:
    if c < 1000:
        print(idx)
        break
    sec_list.append(s)
    idx += 1

print(sec_list)
