import json
import os
import numpy as np
from extract import PEFeatureExtractor

def load_surf_info(path, *args):
    extractor = PEFeatureExtractor()
    f_array = np.empty((0, extractor.dim))
    for fname in args:
        j = 1

        with open(fname) as f:
            for line in f:
                if j > 100000:
                    break
                data = json.loads(line)
                feature_vector = extractor.process_raw_features(data)
                f_array = np.vstack([f_array, feature_vector])
                j += 1

    np.save(path, f_array)

    return f_array

def hash_length(h_list, files):
    h_length = dict()
    for h in h_list:
        h_length[h] = 0

    for fname in files:
        with open(fname) as f:
            for line in f:
                data = json.loads(line)
                hashes = data['hashes']
                for h in h_list:
                    if hashes[h] is not None and len(hashes[h]) > h_length[h]:
                        h_length[h] = len(hashes[h])

    return h_length
